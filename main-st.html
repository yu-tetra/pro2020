<html lang="ja">
<head>
    <meta charset="UTF-8">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" href="./CSS/blackboard.css">
    <link rel="shortcutico" href="favicon.ico">
    <title>黒板</title>
</head>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.21.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.3/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.9.3/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-storage.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
    https://firebase.google.com/docs/web/setup#available-libraries -->

    <script> 
        // Your web app's Firebase configuration
        var cookies = document.cookie;
        //console.log(cookies);
    </script>
<body>

<div>
    <img src="" id="canvas" class="dcanvas" style="background-color: #004643;">
    <script>
        var firebaseConfig = {
            apiKey: "AIzaSyBpmypIXLxfFpHxcAWRnF2vQB_ONU6OISA",
            authDomain: "project2020-93dda.firebaseapp.com",
            databaseURL: "https://project2020-93dda.firebaseio.com",
            projectId: "project2020-93dda",
            storageBucket: "project2020-93dda.appspot.com",
            messagingSenderId: "453159572734",
            appId: "1:453159572734:web:e3f6b15cb3bb4b1b9401af"
        };
        firebase.initializeApp(firebaseConfig);

        var db = firebase.firestore();
        var cookies = document.cookie;
        var cookieItem = cookies.split(";");
        var elem = cookieItem[0].split("=");
        var elem1 = cookieItem[1].split("=");
        var id = "def";

        if(elem[0] == "id"){
        id = elem[1];
        }else{
        id = elem1[1];
        }

        var ref= firebase.firestore().collection("rooms").doc(id).collection("canvas").orderBy("time");

        ref.onSnapshot((snapshot)=> {
            snapshot.docChanges().forEach((change) => {
                if(change.type === "added"){
            // doc.data() is never undefined for query doc snapshots
                    document.getElementById('canvas').src = change.doc.data().canvas;
                }
            });
        });
    </script>

</div>
    
    <div id="tool" class="tool">
        <div>
            <label id="menu">メニュー</label>
            <p id="menulist" class="menulist1">
                <label id="exit_s" class="exit_s">退室</label><br>
                <button id="m_close">閉じる</button>
            </p>
        </div>
    </div>

    <div id="chat" class="chat">
        <textarea id="message" row="10" value="" ></textarea><button id="btn">送信</button>
    </div>

    <div id="disp">
    <table id="tdisp" class="tdisp">
        <script src="chatdisp.js"></script>
    </table>
    </div>

    <script src="chat.js"></script>
    <div id="imag" lass="imag">
        <img id="imgSample" src="./Picture/back.jpg" class="imgSample">
    </div>
        <script src="dispfile.js"></script>


<script>
    document.getElementById("menu").onclick = function () {
    showmenu();
    };

    //メニュー表示・非表示
    function showmenu() {
    var menustatus = document.getElementById("menulist");
    if (menustatus.className == "menulist1") {
        menustatus.className = "menulist";
    } else {
        menustatus.className = "menulist1";
    }
    };

    document.getElementById("exit_s").onclick = function(){
        var exitresult = confirm("部屋を退出しますか？");
        if(exitresult){
            location.href= "exit-st.html";
        }else{
            return;
        };
    };

    document.getElementById("m_close").onclick = function () {
    var wObjballoon2 = document.getElementById("menulist");
    wObjballoon2.className = "menulist1";
    };
</script>
</body>
</html>